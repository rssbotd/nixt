#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C0413,W0611


"prompt"


import os
import readline
import sys
import termios


sys.path.insert(0, os.getcwd())


from nixt.config  import Config


Cfg = Config()
Cfg.mod = "cmd,err,mod,thr"


from nixt.console import Console
from nixt.errors  import errors
from nixt.main    import cmnd, enable, init
from nixt.modules import face
from nixt.parse   import parse
from nixt.user    import iface
from nixt.utils   import forever


def wrap(func):
    "reset console."
    old3 = None
    try:
        old3 = termios.tcgetattr(sys.stdin.fileno())
    except termios.error:
        pass
    try:
        func()
    except (KeyboardInterrupt, EOFError):
        pass
    finally:
        if old3:
            termios.tcsetattr(sys.stdin.fileno(), termios.TCSADRAIN, old3)


def main():
    "main"
    parse(Cfg, " ".join(sys.argv[1:]))
    if "v" in Cfg.opts:
        enable(print)
    csl = Console(print, input)
    if "i" in Cfg.opts:
        init(Cfg.mod, face, iface)
    csl.start()
    forever()


if __name__ == "__main__":
    wrap(main)
    errors()
