#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C0413


"service"


import getpass
import sys


from nixt.config  import Config
from nixt.errors  import Errors, errors
from nixt.main    import init, wrap
from nixt.modules import face
from nixt.user    import iface
from nixt.utils   import banner, forever, modnames, pidfile, privileges


Cfg = Config()
Cfg.mod = ",".join(modnames(face, iface))
Cfg.user = getpass.getuser()


def cprint(txt):
    "flush after print."
    print(txt)
    sys.stdout.flush()


def main():
    "main"
    banner(Cfg, cprint)
    privileges(Cfg.user)
    pidfile(Cfg.pidfile)
    started = []
    for thr in init(Cfg.mod, face, iface):
        started.append(thr.name)
    cprint(f"started: {','.join(sorted(started))}")
    forever()


if __name__ == "__main__":
    Errors.out = print
    wrap(main)
    errors()
